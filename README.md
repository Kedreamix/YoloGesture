# åŸºäºè®¡ç®—æœºè§†è§‰æ‰‹åŠ¿è¯†åˆ«æ§åˆ¶ç³»ç»ŸYoLoGesture (åˆ©ç”¨YOLOå®ç°)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/839b3c550ac74ac894e2f0395f61f780.png)

Streamlitåœ¨çº¿æœåŠ¡å™¨ä½“éªŒç½‘å€ï¼š [https://kedreamix-yologesture.streamlit.app/](https://kedreamix-yologesture.streamlit.app/)

HuggingFaceåœ¨çº¿æœåŠ¡å™¨ä½“éªŒç½‘å€ï¼š[https://huggingface.co/spaces/Kedreamix/YoloGesture](https://huggingface.co/spaces/Kedreamix/YoloGesture)


- [1. é¡¹ç›®å·²å®Œæˆçš„éƒ¨åˆ†](#1-é¡¹ç›®å·²å®Œæˆçš„éƒ¨åˆ†)
- [2. éƒ¨åˆ†å°è¯•ç»“æœ](#2-éƒ¨åˆ†å°è¯•ç»“æœ)
- [3. é¡¹ç›®æ•´ä½“æ¡†æ¶](#3-é¡¹ç›®æ•´ä½“æ¡†æ¶)
    - [3.1. æ•°æ®é›†æ„å»º](#31-æ•°æ®é›†æ„å»º)
    - [3.2. æ¨¡å‹é€‰æ‹©](#32-æ¨¡å‹é€‰æ‹©)
    - [3.3. ä»£ç å®ç°](#33-ä»£ç å®ç°)
- [4. å®éªŒç»“æœè¯¦æƒ…](#4-å®éªŒç»“æœè¯¦æƒ…)
    - [4.1. è®­ç»ƒæƒé‡æ–‡ä»¶ä¸‹è½½](#41-è®­ç»ƒæƒé‡æ–‡ä»¶ä¸‹è½½)
    - [4.2. æ•°æ®é›†æ¦‚å†µ](#42-æ•°æ®é›†æ¦‚å†µ)
- [5. ç¯å¢ƒé…ç½®](#5-ç¯å¢ƒé…ç½®)
- [6. å¿«é€Ÿè¿è¡Œä»£ç ](#6-å¿«é€Ÿè¿è¡Œä»£ç )
- [7. è®­ç»ƒé¢„æµ‹ç»†èŠ‚è§£é‡Š](#7-è®­ç»ƒé¢„æµ‹ç»†èŠ‚è§£é‡Š)
    - [7.1. è®­ç»ƒé…ç½®æ–‡ä»¶ï¼ˆé‡ç‚¹ï¼‰](#71-è®­ç»ƒé…ç½®æ–‡ä»¶é‡ç‚¹)
    - [7.2. è®­ç»ƒè‡ªå·±æ•°æ®é›†](#72-è®­ç»ƒè‡ªå·±æ•°æ®é›†)
    - [7.3. ä½¿ç”¨Tensorboardå¯è§†åŒ–ç»“æœ](#73-ä½¿ç”¨tensorboardå¯è§†åŒ–ç»“æœ)
    - [7.4. é¢„æµ‹æ­¥éª¤](#74-é¢„æµ‹æ­¥éª¤)
    - [7.5. è¯„ä¼°æ­¥éª¤](#75-è¯„ä¼°æ­¥éª¤)
- [8. Streamlit é¡¹ç›®éƒ¨ç½²](#8-streamlit-é¡¹ç›®éƒ¨ç½²)
  - [8.1. æœ¬åœ°è¿è¡Œ](#81-æœ¬åœ°è¿è¡Œ)
  - [8.2. æ£€æµ‹æ–¹æ³•](#82-æ£€æµ‹æ–¹æ³•)
  - [8.3. é€‰æ‹©æ¨¡å‹ä»¥åŠå‚æ•°](#83-é€‰æ‹©æ¨¡å‹ä»¥åŠå‚æ•°)
- [9. å‚è€ƒReference](#9-å‚è€ƒreference)
- [10. ä»£ç æƒé‡å¯å¤ç°ï¼Œå·²å¼€æºï¼ˆæ±‚ğŸŒŸğŸŒŸğŸŒŸï¼‰](#10-ä»£ç æƒé‡å¯å¤ç°å·²å¼€æºæ±‚)


## 1. é¡¹ç›®å·²å®Œæˆçš„éƒ¨åˆ†

- [x] æ•°æ®é›†çš„æ„å»º

- [x] ä»£ç çš„åŸºæœ¬è¿è¡Œå’Œè®­ç»ƒ

- [x] å¢åŠ æ•°æ®é›† 800 -> 1600

- [x] åˆ©ç”¨Mosaicæ•°æ®å¢å¼ºï¼Œä½†æ˜¯ç»“æœä¸å¥½ï¼Œä¹‹åè®­ç»ƒä¸ä¼šé‡‡ç”¨ï¼Œé™¤éæ•°æ®è¶³å¤Ÿå¤š

- [x] å¢åŠ yamlæ–‡ä»¶ï¼Œåˆ©ç”¨yamlé…ç½®æ‰€æœ‰å‚æ•°

- [x] æé«˜å›¾ç‰‡çš„è¾“å…¥shapeï¼Œä»256x256 -> 416x416

- [x] ç”±äºç»“æœä¸ç†æƒ³ï¼Œä½¿ç”¨éƒ¨åˆ†è‡ªåˆ¶æ•°æ®é›†æ›¿æ¢ï¼Œæ•°æ®é›†æ€»æ•°ä¸å˜

- [x] æ·»åŠ yolov4 tiny è½»é‡åŒ–æ¨¡å‹

- [x] å¢åŠ æ³¨æ„åŠ›æœºåˆ¶ï¼Œå¯ä»¥æ¯”è½»é‡åŒ–æ¨¡å‹å¾—åˆ°æ›´ä¸é”™çš„ç»“æœ

  

<!-- ä½¿ç”¨MobileNetä½œä¸ºbackboneï¼Œè½»é‡åŒ–æ¨¡å‹  ä½¿ç”¨yolov5 æˆ–è€… yolox æ”¹è¿›æ–¹æ³• -->



## 2. éƒ¨åˆ†å°è¯•ç»“æœ

- [x] ä½¿ç”¨Mosaic ç»“æœè¾ƒå·®
- [x] åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»“æœååˆ†å·®ï¼ŒåŸå› æ˜¯æ•°æ®é›†æ ‡æ³¨å‡ºç°é”™è¯¯ï¼Œä¼šé‡æ–°ä¿®æ”¹æ•°æ®é›†
- [x] ç”¨SGDçš„ç»“æœæ²¡æœ‰Adamå¥½
- [x] frontçš„æ•°æ®é›†éœ€è¦é‡æ–°ä¿®æ”¹æ‰èƒ½å¾—åˆ°æ›´å¥½çš„ç»“æœ
- [x] ä½¿ç”¨tinyæ¨¡å‹é€Ÿåº¦æ›´å¿«ï¼Œç»“æœè™½ç„¶å·®ä¸€ç‚¹ï¼Œä½†æ˜¯åªæ˜¯ä¸€ä¸ªé€Ÿåº¦ä¸ç²¾åº¦çš„trade off



## 3. é¡¹ç›®æ•´ä½“æ¡†æ¶

1ã€ äº†è§£é¡¹ç›®ç ”ç©¶çš„èƒŒæ™¯ä»¥åŠå…¶æ„ä¹‰ï¼Œå­¦ä¹ å…¶ä¸­çš„åˆ›æ–°ç‚¹å’Œç§‘ç ”ä»·å€¼ã€‚

2ã€ ä½¿ç”¨pythonè¯­è¨€å¯¹é¡¹ç›®ä¸­çš„ä»£ç è¿›è¡Œç¼–å†™ã€‚ç ”ç©¶é¡¹ç›®æºä»£ç ï¼Œç†è§£é¡¹ç›®å·¥ç¨‹çš„ä»£ç ç»“æ„ã€åŸç†åŠå…¶åŠŸèƒ½ã€‚

3ã€ å­¦ä¹ æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚ç†è§£å·ç§¯ç¥ç»ç½‘ç»œçš„ç›¸å…³æ¦‚å¿µï¼ŒåŒ…æ‹¬ç¥ç»å…ƒç³»ç»Ÿã€å±€éƒ¨æ„Ÿå—é‡ã€æƒå€¼å…±äº«å’Œå·ç§¯ç¥ç»ç½‘ç»œæ€»ä½“ç»“æ„ï¼›äº†è§£ç›®å‰å¸¸è§çš„ç›®æ ‡æ£€æµ‹æ–¹æ³•å’ŒYOLOv4ç®—æ³•æ¡†æ¶ï¼Œä»¥åŠåŸºäºYOLOv4çš„æ‰‹åŠ¿è¯†åˆ«ç®—æ³•ã€‚

4ã€ è®¾è®¡å¹¶åˆ¶ä½œé’ˆå¯¹æœ¬é¡¹ç›®æ‰‹åŠ¿æ§åˆ¶æ•°æ®é›†ï¼Œå¹¶ä½¿ç”¨æ•°æ®å¢å¹¿çš„æ–¹å¼å¯¹æ•°æ®é›†è¿›è¡Œæ‰©å……ï¼ŒåŒæ—¶ä½¿ç”¨å›¾åƒå¤„ç†çš„æ–¹æ³•åŒ…æ‹¬ä¸­å€¼æ»¤æ³¢ã€é˜ˆå€¼åˆ†å‰²ç­‰å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚

5ã€ è®­ç»ƒæ¨¡å‹ï¼Œå¯¹ç›®æ ‡æ£€æµ‹æ€§èƒ½è¿›è¡Œæµ‹è¯•ã€‚äº†è§£å®éªŒç¯å¢ƒä»¥åŠè¯„ä»·æ ‡å‡†ï¼Œæµ‹è¯•æœ¬é¡¹ç›®ç ”ç©¶çš„æ‰‹åŠ¿è¯†åˆ«ç®—æ³•çš„å®éªŒç»“æœï¼Œç„¶åé€šè¿‡é‡‡ç”¨æ§åˆ¶å˜é‡æ–¹æ³•å¯¹æ‰‹åŠ¿è¯†åˆ«ç®—æ³•è¿›è¡Œå¤šç»„å®éªŒï¼Œä»¥è¯„ä¼°å…¶åœ¨ä¸åŒç¯å¢ƒä¸‹çš„è¯†åˆ«æ•ˆæœï¼Œä½¿ç”¨éªŒè¯é›†å¯¹æ‰‹åŠ¿è¯†åˆ«ç®—æ³•çš„ç²¾åº¦å’Œé€Ÿåº¦è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚

6ã€ æ€»ç»“æœ¬é¡¹ç›®çš„ç ”ç©¶å·¥ä½œï¼Œå¯¹åŸºäºæ— äººæœºçš„æ‰‹åŠ¿è¯†åˆ«æ¼”å‰§æä¾›åˆ›æ–°ç‚¹ä¸å‘å±•å»ºè®®ã€‚

### 3.1. æ•°æ®é›†æ„å»º

1. è®¾è®¡å¹¶åˆ¶ä½œé’ˆå¯¹æœ¬é¡¹ç›®æ‰‹åŠ¿æ§åˆ¶æ•°æ®é›†ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œåˆ†ç±»ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/5b3c7cc2c58c404987d54d9a2f5bb68d.png)



2. ä½¿ç”¨Labelimgæ ‡æ³¨å·¥å…·è®¾è®¡é’ˆå¯¹æœ¬é¡¹ç›®çš„æ‰‹åŠ¿æ•°æ®é›†ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œæ ‡æ³¨ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/3312206223674362b64026836184e3e4.png)

### 3.2. æ¨¡å‹é€‰æ‹©

åœ¨å‰æœŸçš„æ¨¡å‹é€‰æ‹©ä¸­ï¼Œç®€å•çš„é€‰æ‹©äº†YOLOv4çš„æ¨¡å‹è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•

 **YOLOv4 = CSPDarknet53ï¼ˆä¸»å¹²ï¼‰ + SPP** **é™„åŠ æ¨¡å—ï¼ˆé¢ˆ** **ï¼‰ +** **PANet** **è·¯å¾„èšåˆï¼ˆé¢ˆ** **ï¼‰ + YOLOv3ï¼ˆå¤´éƒ¨ï¼‰**

![img](https://pdf.cdn.readpaper.com/parsed/fetch_target/699143cdb334ecfc63caf8192472490c_0_Figure_1.png)



### 3.3. ä»£ç å®ç°

- [x] ä¸»å¹²ç‰¹å¾æå–ç½‘ç»œï¼šDarkNet53 => CSPDarkNet53
- [x] ç‰¹å¾é‡‘å­—å¡”ï¼šSPPï¼ŒPAN
- [x] è®­ç»ƒç”¨åˆ°çš„å°æŠ€å·§ï¼šMosaicæ•°æ®å¢å¼ºã€Label Smoothingå¹³æ»‘ã€CIOUã€å­¦ä¹ ç‡ä½™å¼¦é€€ç«è¡°å‡
- [x] æ¿€æ´»å‡½æ•°ï¼šä½¿ç”¨Mishæ¿€æ´»å‡½æ•°
- [x] å¢åŠ yamlé…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯
- [x] æ·»åŠ detect.pyï¼Œåˆ©ç”¨æ­¤è¿›è¡ŒåŠè‡ªåŠ¨æ ‡æ³¨ï¼Œå¯ä»¥æ–¹ä¾¿æ ‡æ³¨å…¶ä»–ç±»ä¼¼äºå¯¹åº”ğŸ‘‹çš„æ•°æ®é›†
- [x] ä¿®æ”¹æˆå‘½ä»¤è¡Œè¿è¡Œçš„å¿«é€Ÿæ¨¡å¼ï¼Œå¾ˆæ–¹ä¾¿ï¼Œå¿«é€Ÿè¿è¡Œå’Œç†è§£
- [x] åˆ©ç”¨streamlitéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥éšæ—¶ä½¿ç”¨ï¼Œåœ¨çº¿demo [https://kedreamix-yologesture.streamlit.app/](https://kedreamix-yologesture.streamlit.app/)
- [ ] ......



## 4. å®éªŒç»“æœè¯¦æƒ…

| è®­ç»ƒæ•°æ®é›† |                         æƒå€¼æ–‡ä»¶åç§°                         | è¿­ä»£æ¬¡æ•° | Batch-size | å›¾ç‰‡shape | å¹³å‡å‡†ç¡®ç‡ | mAP 0.5 | fps   |
| :--------: | :----------------------------------------------------------: | :------: | :--------: | :-------: | :--------: | :-----: | ----- |
| Gesture v1 |                  yolo4_gesture_weights.pth                   |   150    |    4->8    |  256x256  |   61.65    |  51.66  |       |
| Gesture v2 |                   yolo4tiny_gesture_SE.pth                   |   100    |   64->32   |  416x416  |    83.6    |  95.18  | 76.08 |
| Gesture v2 |                  yolo4tiny_gesture_CBAM.pth                  |   100    |   64->32   |  416x416  |   89.35    |  98.85  | 70.01 |
| Gesture v2 |                  yolo4tiny_gesture_ECA.pth                   |   100    |   64->32   |  416x416  |   88.37    |  96.26  | 77.19 |
| Gesture v2 |                    yolo4tiny_gesture.pth                     |   100    |   64->32   |  416x416  |   87.01    |  95.86  | 81.81 |
| Gesture v2 |                 yolo4_gesture_weightsv2.pth                  |   100    |    4->8    |  256x256  |   84.51    |  90.77  | 24.21 |
| Gesture v3 | [yolov4_tiny.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_tiny.pth) |   150    |   64->32   |  416x416  |   75.05    |  91.30  |       |
| Gesture v3 | [yolov4_SE.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_SE.pth) |   150    |   64->32   |  416x416  |   78.06    |  90.13  |       |
| Gesture v3 | [yolov4_CBAM.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_CBAM.pth) |   150    |   64->32   |  416x416  |   91.09    |  94.97  |       |
| Gesture v3 | [yolov4_ECA.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_ECA.pth) |   150    |   64->32   |  416x416  |   94.58    |  83.24  |       |
| Gesture v3 | [yolov4_weights_ep150_416.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_weights_ep150_416.pth) |   150    |   64->32   |  416x416  |   95.145   |  98.35  |       |
| Gesture v3 | [yolov4_weights_ep150_608.pth](https://github.com/Kedreamix/YoloGesture/releases/download/v1.0/yolov4_weights_ep150_608.pth) |   150    |   64->32   |  608x608  |   93.64    |  97.23  |       |

> Gesture v1ä¸­å­˜åœ¨æ•°æ®é›†é—®é¢˜ï¼Œæ‰€ä»¥æ¨¡å‹ç»“æ„ä¸å¥½
>
> Gesture v2ä¸­é‡æ–°ä¿®æ”¹æ•°æ®é›†
>
> Gesture v3ä¸­ä¿®æ”¹frontæ•°æ®é›†

Batch-Size 64->32æ˜¯æŒ‡åœ¨è¿›è¡Œè®­ç»ƒçš„æ—¶å€™ï¼Œå‰åŠæ®µå†»ç»“çš„æ—¶å€™ä½¿ç”¨çš„bsä¸º64ï¼Œåœ¨åç»­ä¸å†»ç»“è®­ç»ƒä½¿ç”¨bs=32



### 4.1. è®­ç»ƒæƒé‡æ–‡ä»¶ä¸‹è½½

è®­ç»ƒæ‰€éœ€çš„yolo4_weights.pthæœ‰ä¸¤ç§æ–¹å¼ä¸‹è½½ã€‚ï¼ˆreleaseåŒ…å«æ‰€æœ‰è¿‡ç¨‹çš„æƒé‡ï¼Œç™¾åº¦ç½‘ç›˜å’Œå¥¶ç‰›åªè®°å½•æœ€æ–°çš„æƒé‡ï¼‰

- å¯ä»¥ä»æˆ‘çš„releaseä¸‹è½½æƒé‡ [https://github.com/Kedreamix/YoloGesture/releases/tag/v1.0](https://github.com/Kedreamix/YoloGesture/releases/tag/v1.0)

- å¯ä»¥ä»æˆ‘çš„huggingfaceçš„modelä¸‹è½½æƒé‡ [https://huggingface.co/Kedreamix/YoloGestureWeights](https://huggingface.co/Kedreamix/YoloGestureWeights)

- ä¹Ÿå¯ä»¥ç™¾åº¦ç½‘ç›˜ä¸‹è½½

  é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Pt11VHMaHqSsPjb50W5IeQ
  æå–ç ï¼š6666
  
- ç”±äºç™¾åº¦ç½‘ç›˜ä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œè¿™é‡Œä¹Ÿç»™ä¸€ä¸ªä¸é™é€Ÿçš„é“¾æ¥ ï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼‰

  ä¼ è¾“é“¾æ¥ï¼šhttps://cowtransfer.com/s/dc5e0f7f43a940 æˆ– æ‰“å¼€ã€å¥¶ç‰›å¿«ä¼ ã€‘cowtransfer.com ä½¿ç”¨ä¼ è¾“å£ä»¤ï¼šftyvu0 æå–ï¼›
  
  

### 4.2. æ•°æ®é›†æ¦‚å†µ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/5b3c7cc2c58c404987d54d9a2f5bb68d.png)

- **Gesture v1** åªæœ‰800å¼ å›¾ç‰‡ï¼Œæ•°é‡è¾ƒå°‘
- **Gesture** **v2** å¢åŠ äº†800å¼ å›¾ç‰‡ï¼Œæ•°é‡å¢å¤šï¼Œä¸€å…±1600å¼ å›¾ç‰‡

åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»“æœååˆ†å·®ï¼ŒåŸå› æ˜¯æ•°æ®é›†æ ‡æ³¨å‡ºç°é”™è¯¯ï¼Œä¼šé‡æ–°ä¿®æ”¹æ•°æ®é›†

- **Gesture v3** ä¸­ä¿®æ”¹äº†frontçš„æ‰‹åŠ¿ï¼Œä½¿å¾—frontç»“æœå¤§å¤§æå‡ï¼Œå¹³å‡å‡†ç¡®ç‡å¢å¤§

> ä¸Šè¿°å±•ç¤ºå›¾æ˜¯å…³äºGesture v1çš„æ‰‹åŠ¿ï¼Œåç»­æ•°æ®è¿›è¡Œäº†ä¿®æ”¹



æ•´ä½“æ•°æ®é›†ä¸€å…±å«æœ‰1600å¼ ï¼Œ8ä¸ªç±»åˆ«çš„æ‰‹åŠ¿ï¼Œæˆ‘çš„Gesture v3æœ€åå°±æ˜¯8ä¸ªç±»åˆ«ï¼Œå¤§æ¦‚1600å¼ çš„æ•°æ®é›†ï¼Œç±»åˆ«åˆ†åˆ«æ˜¯

- up
- down
- left
- right
- front
- back
- clockwise
- anticlockwise

æ•°æ®å·²ç»æ”¾åœ¨releaseä¸­äº†ï¼Œå¯ä»¥ä¸‹è½½è‡ªç”¨

> ä¹‹åæˆ‘ä¹Ÿåšäº†ç±»ä¼¼çš„æ‰‹åŠ¿è¯†åˆ«çš„ä»»åŠ¡ï¼Œé‡Œé¢çš„æ•°æ®é›†æœ‰18ä¸ªç±»åˆ« HaGRIDæ‰‹åŠ¿è¯†åˆ«æ•°æ®é›†ï¼Œé‡Œé¢çš„æ‰‹åŠ¿ç»“æœæ›´å¤šï¼Œå¹¶ä¸”ä¹Ÿæ›´å¤§ï¼Œæ€»å…±æœ‰716Gï¼Œå»ºè®®å¯ä»¥ç¼©å°ä»¥åè¿›è¡Œè®­ç»ƒå¢å¼ºï¼Œå¦‚æœæœ‰æœºä¼šï¼Œæˆ‘å¯ä»¥æ‹¿ä¸€ä¸ªå¤šç±»åˆ«çš„æˆ‘ä¹Ÿæ¥è®­ç»ƒä¸€ä¸‹
>
> ä»¥ä¸‹æ˜¯HaGRIDçš„æ‰‹åŠ¿è¯†åˆ«çš„ç±»åˆ«ï¼Œæ”¯æŒæ›´å¤šçš„æ‰‹åŠ¿è¯†åˆ«çš„ç»“æœï¼Œè¿™æ˜¯å®˜æ–¹ä¸‹è½½åœ°å€ï¼š[https://github.com/hukenovs/hagrid](https://github.com/hukenovs/hagrid)
>
> [![gestures](https://github.com/hukenovs/hagrid/raw/master/images/gestures.jpg)](https://github.com/hukenovs/hagrid/blob/master/images/gestures.jpg)



## 5. ç¯å¢ƒé…ç½®

æˆ‘ç”¨çš„æ˜¯torch==1.8.1 torchvision==0.9.1

> ä»£ç åœ¨æ›´é«˜çš„ç‰ˆæœ¬ä¹Ÿæ˜¯é€‚é…çš„ï¼Œæˆ‘è§‰å¾—å¯èƒ½å»>=1.7çš„åº”è¯¥éƒ½æ˜¯å¯ä»¥çš„

ç›¸å¯¹åº”çš„åº“å¯ä»¥ç›´æ¥åˆ©ç”¨ä»¥ä¸‹ä»£ç åœ¨å½“å‰è·¯å¾„è¿›è¡Œè¿è¡Œï¼Œåˆ©ç”¨æ¸…åæºè¿›è¡Œæ¢æº

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```



## 6. å¿«é€Ÿè¿è¡Œä»£ç 

ä»¥ä¸‹å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼Œåœ¨å‘½ä»¤è¡Œè¿è¡Œå¯èƒ½ä¼šæ›´å¥½ä¸€ç‚¹

<details open>
<summary>Install</summary>


```bash
git clone https://github.com/Kedreamix/YoloGesture.git 
cd YoloGesture
pip install -r requirements.txt  # -i https://pypi.tuna.tsinghua.edu.cn/simple/ # install å¯ä»¥åŠ ä¸Šæ¸…åæº
```

</details>

<details open>
<summary>Data</summary> 
è¿™ä¸€éƒ¨åˆ†ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯2007_train.txtå’Œ2007_val.txtï¼Œåœ¨æ¯ä¸€è¡ŒåŒ…æ‹¬äº†å›¾ç‰‡è·¯å¾„å’Œå¯¹åº”çš„æ ‡ç­¾ï¼Œä¹‹åä»£ç ä¼šè¯»å–æ–‡ä»¶å¤¹VOCdevkit/VOC2007ä¸‹çš„å›¾ç‰‡å’Œæ ‡ç­¾


```python
python voc_annotation.py
```

</details>

<details open>
<summary>Optional</summary> 
å¯é€‰ï¼Œyolov4æœ‰å¯¹anchorsè¿›è¡ŒKmeansè®¡ç®—ï¼Œä½†æ˜¯ç”¨yolov4è‡ªå¸¦çš„ä¹Ÿå¯ä»¥ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯å¯é€‰æ‹©çš„ï¼Œåšå®Œæœ‰ä¸€ä¸ªå¯è§†åŒ–çš„ç»“æœ


```python
python kmeans_for_anchors.py
```

![kmeans_for_anchors.jpg](https://github.com/Kedreamix/YoloGesture/blob/main/kmeans_for_anchors.jpg?raw=true)

</details>

<details open>
<summary>Training</summary> 

æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢è®¾ç½®æ‰€éœ€è¦çš„å‚æ•°ï¼Œphiä»£è¡¨ç€ä¸åŒçš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œweightsä»£è¡¨ç€æƒé‡ï¼Œå…¶ä»–çš„æ˜¯æˆ‘ä»¬çš„ä¸€äº›å‚æ•°çš„è®¾ç½®ï¼Œéƒ½æ˜¯å¯è°ƒçš„ï¼Œå‚æ•°çš„éƒ¨åˆ†è§£é‡Šéƒ½å¯ä»¥ä»python train.py --helpçœ‹åˆ°

```bash
usage: train.py [-h] [--init INIT] [--epochs EPOCHS] [--weights WEIGHTS]
                [--freeze] [--freeze-epochs FREEZE_EPOCHS]
                [--freeze-size FREEZE_SIZE] [--batch-size BATCH_SIZE]
                [--optimizer {sgd,adam,adamw}] [--num_workers NUM_WORKERS]
                [--lr LR] [--tiny] [--phi PHI] [--weight-decay WEIGHT_DECAY]
                [--momentum MOMENTUM] [--save-period SAVE_PERIOD] [--cuda]
                [--shape SHAPE] [--fp16] [--mosaic]
                [--lr_decay_type {cos,step}] [--distributed]

optional arguments:
  -h, --help            show this help message and exit
  --init INIT           ä»init epochå¼€å§‹è®­ç»ƒ
  --epochs EPOCHS       epochs for training
  --weights WEIGHTS     initial weights path åˆå§‹æƒé‡çš„è·¯å¾„
  --freeze              è¡¨ç¤ºæ˜¯å¦å†»ç»“è®­ç»ƒ
  --freeze-epochs FREEZE_EPOCHS
                        epochs for feeze å†»ç»“è®­ç»ƒçš„è¿­ä»£æ¬¡æ•°
  --freeze-size FREEZE_SIZE
                        total batch size for Freezeing
  --batch-size BATCH_SIZE
                        total batch size for all GPUs
  --optimizer {sgd,adam,adamw}
                        è®­ç»ƒä½¿ç”¨çš„optimizer
  --num_workers NUM_WORKERS
                        ç”¨äºè®¾ç½®æ˜¯å¦ä½¿ç”¨å¤šçº¿ç¨‹è¯»å–æ•°æ®
  --lr LR               Learning Rate å­¦ä¹ ç‡çš„åˆå§‹å€¼
  --tiny                ä½¿ç”¨yolov4-tinyæ¨¡å‹
  --phi PHI             yolov4-tinyæ‰€ä½¿ç”¨çš„æ³¨æ„åŠ›æœºåˆ¶çš„ç±»å‹
  --weight-decay WEIGHT_DECAY
                        æƒå€¼è¡°å‡ï¼Œå¯é˜²æ­¢è¿‡æ‹Ÿåˆ
  --momentum MOMENTUM   ä¼˜åŒ–å™¨ä¸­çš„å‚æ•°
  --save-period SAVE_PERIOD
                        å¤šå°‘ä¸ªepochsä¿å­˜ä¸€æ¬¡æƒé‡
  --cuda                è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨GPU
  --shape SHAPE         è¾“å…¥å›¾åƒçš„shapeï¼Œä¸€å®šè¦æ˜¯32çš„å€æ•°
  --fp16                æ˜¯å¦ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
  --mosaic              Yolov4çš„tricksåº”ç”¨ é©¬èµ›å…‹æ•°æ®å¢å¼º
  --lr_decay_type {cos,step}
                        cos
  --distributed         æ˜¯å¦ä½¿ç”¨å¤šå¡è¿è¡Œ
```

è¿™é‡Œå¯¹ä¸€äº›å¸¸ç”¨å‚æ•°è¿›è¡Œè§£é‡Š

- fp16

  ç”±äºè®­ç»ƒç¥ç»ç½‘ç»œï¼Œæœ‰æ—¶å€™å¾—åˆ°çš„æƒé‡çš„ç²¾åº¦éƒ½æ˜¯64ä½æˆ–è€…32ä½çš„ï¼Œä¿å­˜å’Œè®­ç»ƒçš„æ—¶å€™éƒ½å äº†å¾ˆå¤šæ˜¾å­˜ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™äº›æ˜¯ä¸å¿…è¦çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨fp16å°†ç²¾åº¦è®¾ä¸º16ä½ï¼Œè¿™æ ·å¤§æ¦‚å¯ä»¥å‡å°‘ä¸€åŠçš„æ˜¾å­˜

- phi

  è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œphi = 0ä»£è¡¨çš„æ˜¯yolov4_tinyï¼Œä¹Ÿå°±æ˜¯æ”¹è¿›çš„è½»é‡åŒ–yolov4ï¼Œè€Œphi = 1,2,3åˆ†åˆ«æ˜¯åŠ äº†SEï¼ŒCBAMï¼ŒECAä¸‰ç§æ³¨æ„åŠ›æœºåˆ¶å¾—åˆ°çš„ç»“æœã€‚å…·ä½“å¯¹SEï¼ŒCBAMï¼ŒECAæ³¨æ„åŠ›æœºåˆ¶ä¸æ‡‚çš„ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡åšæ–‡ï¼Œæˆ‘è§‰å¾—å†™çš„è›®å¥½çš„ï¼š[https://blog.csdn.net/weixin_44791964/article/details/121371986](https://blog.csdn.net/weixin_44791964/article/details/121371986)ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç»ã€‚

- freeze

  é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥ä»ä¸‹é¢çš„ä»£ç çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å†»ç»“è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸å†»ç»“ï¼Œé€šè¿‡å‚æ•°freezeæ¥æ§åˆ¶ï¼Œè¿˜å¯ä»¥æ§åˆ¶å†»ç»“æ¬¡æ•°çš„å†»ç»“æ—¶çš„batch-sizeï¼Œå†»ç»“çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠbatch-sizeè°ƒé«˜ä¸€ç‚¹ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è°ƒä¸€ä¸‹freeze-epochså‚æ•°å’Œfreeze-sizeå‚æ•°

å¦‚æœå¯¹äºä¸åŒæ¨¡å‹è®­ç»ƒçš„ä¸åŠ¨çš„ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„è®­ç»ƒé¢„æµ‹ç»†èŠ‚è§£é‡Š

```python
# å†»ç»“è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œåˆ©ç”¨å·²æœ‰çš„yolov4_SE.pthçš„æƒé‡è¿›è¡Œ
python train.py --tiny --phi 1 --epochs 100 \
        --weights model_data/yolov4_SE.pth \
        --freeze --freeze-epochs 50 --freeze-size 8 \
        --batch-size 4 --shape 416 \
        --fp16 --cuda

# å¿«é€Ÿè¿è¡Œå°è¯•ï¼Œé‡æ–°å­¦ä¹ 
python train.py --tiny --phi 1 --epochs 10 \
        --batch-size 4 --shape 416 \
        --fp16 --cuda
```

åœ¨åç»­ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œä¸ç”¨æ‰“é‚£ä¹ˆå¤šçš„å­—æ¯ï¼Œè¿˜è¿›è¡Œäº†ç¼©å†™çš„ä¿®æ”¹ï¼ŒæŠŠ--freezeç®€åŒ–æˆ-fï¼Œ--weights ç®€åŒ–æˆ -w, --freeze-epochsjç®€åŒ–æˆ-feï¼Œ--freeze-size ç®€åŒ–æˆfbï¼Œ --batch-sizeç®€åŒ–æˆ-bsï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿è¿è¡Œçš„æ—¶å€™è®¾ç½®å‚æ•°

è¿™æ®µä»£ç å’Œä¸Šé¢æ˜¯ç­‰ä»·çš„

```python
# å†»ç»“è¿›è¡Œè¿ç§»å­¦ä¹ 
python train.py --tiny --phi 1 --epochs 100 \
        -w model_data/yolov4_SE.pth \
        -f -fe 50 -fs 8 \
        --bs 4 --shape 416 \
        --fp16 --cuda

# å¿«é€Ÿè¿è¡Œå°è¯•ï¼Œé‡æ–°å­¦ä¹ 
python train.py --tiny --phi 1 --epochs 10 \
        --batch-size 4 --shape 416 \
        --fp16 --cuda
```

</details>

<details open>
<summary>Predict</summary> 

predictä¹Ÿæœ‰ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚ä»¥ä»€ä¹ˆæ¨¡å¼è¿è¡Œï¼Œåˆ†åˆ«æœ‰['dir_predict', 'video', 'fps','predict','heatmap']ï¼Œé»˜è®¤æ˜¯ç”¨predictæ¥æ¨ç†imgæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å›¾ç‰‡

```python
# python predict.py --mode dir_predict \
# --tiny --phi 1 \
# --weights model_data/yolov4_SE.pth \
# --cuda --shape 416
python predict.py --tiny --cuda
```

</details>

<details open>
<summary>Get Map</summary> 

è¿™ä¸€éƒ¨åˆ†å¯ä»¥å¾—åˆ°å¬å›ç‡å’Œç²¾ç¡®ç‡ç­‰å¯è§†åŒ–çš„å›¾ç‰‡ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ç»“æœ

```python
# å¯¹éªŒè¯é›†è¿›è¡Œè®¡ç®—
# python get_map.py --mode 0 \
# --tiny --phi 1 \
# --weights model_data/yolov4_SE.pth \
# --cuda --shape 416
# python .\get_map.py --cuda --mode 0 --tiny --phi 3 --weights model_data/yolotv4_ECA.pth
python get_map.py --tiny --cuda
```

</details>

æ‰€æœ‰çš„å‚æ•°éƒ½å¯ä»¥é€šè¿‡ï¼Œé€šè¿‡helpçœ‹åˆ°è§£é‡Š

```python
python train.py -h
python get_map.py -h
python predict.py -h
```

é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæœ‰å¤šä¸ªGPUï¼Œéœ€è¦è®¾å®šæŒ‡å®šçš„GPUï¼Œåœ¨pythonå‰åŠ ä¸Šé…ç½®CUDA_VISIBLE_DEVICES=3ï¼Œè¡¨ç¤ºä½¿ç”¨ç¬¬å››å—GPU

```python
# æ¯”å¦‚ä½¿ç”¨ç¬¬4å—GPU
CUDA_VISIBLE_DEVICES=3 python train.py ...
```

æˆ–è€…æ˜¯å¤šå—GPUï¼Œæ¯”å¦‚æœ‰0ï¼Œ1ä¸¤å—GPU

```python
# æ¯”å¦‚ä½¿ç”¨ç¬¬0,1å—GPU
CUDA_VISIBLE_DEVICES=0,1 python train.py ...
```





## 7. è®­ç»ƒé¢„æµ‹ç»†èŠ‚è§£é‡Š

### 7.1. è®­ç»ƒé…ç½®æ–‡ä»¶ï¼ˆé‡ç‚¹ï¼‰

è¿™ä¸ªé‡ä¸­ä¹‹é‡ï¼Œåœ¨model_dataæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œé‡Œé¢åŒ…æ‹¬éƒ¨åˆ†éœ€è¦è¿è¡Œçš„å‚æ•°

åªéœ€è¦è°ƒèŠ‚é‡Œé¢çš„å‚æ•°ï¼Œç„¶åè¿è¡Œå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬çš„ç»“æœï¼Œå®Œå…¨æ˜¯okçš„ï¼Œåªéœ€è¦æ”¹é…ç½®æ–‡ä»¶ï¼Œå…¶ä»–å‚æ•°å¯ä»¥åœ¨å‘½ä»¤è¡Œä¿®æ”¹ï¼Œç›´æ¥è¿è¡Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œä¸»è¦æ˜¯ä¿®æ”¹train.pyçš„éƒ¨åˆ†ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è®­ç»ƒ

```yaml
#------------------------------detect.py--------------------------------#
# è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†åŠè‡ªåŠ¨æ ‡æ³¨æ•°æ®ï¼Œå¯ä»¥å‡è½»è´Ÿæ‹…ï¼Œéœ€è¦æå‰è®­ç»ƒä¸€ä¸ªæƒé‡ï¼Œä»¥Labelmeæ ¼å¼ä¿å­˜
# dir_origin_path å›¾ç‰‡å­˜æ”¾ä½ç½®
# dir_save_path Annotationä¿å­˜ä½ç½®
# ----------------------------------------------------------------------#
dir_detect_path: ./JPEGImages 
detect_save_path: ./Annotation

# ----------------------------- train.py -------------------------------#
nc: 8 # ç±»åˆ«çš„æ•°é‡
classes: ["up","down","left","right","front","back","clockwise","anticlockwise"] # ç±»åˆ«
confidence: 0.5 # ç½®ä¿¡åº¦
nms_iou: 0.3
letterbox_image: False

lr_decay_type: cos # ä½¿ç”¨åˆ°çš„å­¦ä¹ ç‡ä¸‹é™æ–¹å¼ï¼Œå¯é€‰çš„æœ‰stepã€cos
# ç”¨äºè®¾ç½®æ˜¯å¦ä½¿ç”¨å¤šçº¿ç¨‹è¯»å–æ•°æ®
# å¼€å¯åä¼šåŠ å¿«æ•°æ®è¯»å–é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šå ç”¨æ›´å¤šå†…å­˜
# å†…å­˜è¾ƒå°çš„ç”µè„‘å¯ä»¥è®¾ç½®ä¸º2æˆ–è€…0ï¼Œwinå»ºè®®è®¾ä¸º0
num_workers: 4
```



### 7.2. è®­ç»ƒè‡ªå·±æ•°æ®é›†

1. æ•°æ®é›†çš„å‡†å¤‡ 
   è®­ç»ƒå‰å°†æ ‡ç­¾æ–‡ä»¶æ”¾åœ¨VOCdevkitæ–‡ä»¶å¤¹ä¸‹çš„VOC2007æ–‡ä»¶å¤¹ä¸‹çš„Annotationä¸­ã€‚   
   è®­ç»ƒå‰å°†å›¾ç‰‡æ–‡ä»¶æ”¾åœ¨VOCdevkitæ–‡ä»¶å¤¹ä¸‹çš„VOC2007æ–‡ä»¶å¤¹ä¸‹çš„JPEGImagesä¸­ã€‚   

   

2. æ•°æ®é›†çš„å¤„ç† 
   åœ¨å®Œæˆæ•°æ®é›†çš„æ‘†æ”¾ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨voc_annotation.pyè·å¾—è®­ç»ƒç”¨çš„2007_train.txtå’Œ2007_val.txtã€‚   
   ä¿®æ”¹voc_annotation.pyé‡Œé¢çš„å‚æ•°ã€‚ç¬¬ä¸€æ¬¡è®­ç»ƒå¯ä»¥ä»…ä¿®æ”¹classes_pathï¼Œclasses_pathç”¨äºæŒ‡å‘æ£€æµ‹ç±»åˆ«æ‰€å¯¹åº”çš„txtã€‚   

   ç„¶åå†å‰é¢æ‰€è¯´çš„data.yamlä¸­å†™æ¸…æ¥šè‡ªå·±çš„ç±»åˆ«ä»¥åŠç±»åˆ«çš„æ•°é‡

   ```bash
   nc: 8 # ç±»åˆ«çš„æ•°é‡
   classes: ["up","down","left","right","front","back","clockwise","anticlockwise"] # ç±»åˆ«
   ```

   

3. å¼€å§‹ç½‘ç»œè®­ç»ƒ  

   ä¹‹åæ ¹æ®å¿«é€Ÿè¿è¡Œtrain.pyï¼Œè¿è¡Œtrain.pyå¼€å§‹è®­ç»ƒäº†ï¼Œåœ¨è®­ç»ƒå¤šä¸ªepochåï¼Œæƒå€¼ä¼šç”Ÿæˆåœ¨logsæ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥è‡ªå·±è®¾è¿­ä»£æ¬¡æ•°ä¿å­˜æƒé‡ï¼Œå¦‚ä¸Šè¿°å¿«é€Ÿè¿è¡Œå³å¯ã€‚

   è¿™é‡Œé¢æˆ‘å†…ç½®äº†5ä¸ªæ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯æœ€åŸå§‹çš„yolov4æ¨¡å‹ï¼Œä»¥åŠyolov4-tinyï¼Œyolov4-SEï¼Œyolov4-ECAï¼Œyolov4-CBAMå››ç§æ¨¡å‹ï¼Œè¿™å››ç§æ¨¡å‹éƒ½å¯ä»¥è¿›è¡Œè®­ç»ƒï¼Œå…¶ä¸­yolov4-tinyï¼Œyolov4-SEï¼Œyolov4-ECAï¼Œyolov4-CBAMéƒ½å±äºå°æ¨¡å‹ï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯tinyæ¨¡å‹ï¼Œå¾—åˆ°çš„æƒé‡ä¹Ÿæ¯”è¾ƒå°é€Ÿåº¦ä¹Ÿä¼šæ¯”è¾ƒå¿«ï¼Œè¿™å‡ ç§æ–¹å¼æœ‰ä¸åŒçš„å‚æ•°ï¼Œæˆ‘ç°åœ¨ç®€å•çš„ä»‹ç»ï¼Œæˆ‘ç”¨tinyå’Œphiçš„å‚æ•°å¯¹ä»–ä»¬è¿›è¡Œåˆ†å¼€

   - phi = 0 yolov4-tiny
   - phi = 1 yolov4-SE
   - phi = 2 yolov4-CBAM
   - phi = 3 yolov4-ECA

   ```python
   # yolov4 æ¨¡å‹
   python train.py --epochs 10 --shape 416 --cuda --batch-size 4
   # yolov4-tiny
   python train.py --epochs 10 --shape 416 --cuda --batch-size 8 --tiny --phi 0
   # yolov4-SE
   python train.py --epochs 10 --shape 416 --cuda --batch-size 8 --tiny --phi 1
   # yolov4-CBAM
   python train.py --epochs 10 --shape 416 --cuda --batch-size 8 --tiny --phi 2
   # yolov4-ECA
   python train.py --epochs 10 --shape 416 --cuda --batch-size 8 --tiny --phi 3
   ```

   å¦‚æœè¿˜è¦åšå…¶ä»–å‚æ•°å¯¹ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å¿«é€Ÿè¿è¡Œä»£ç çš„è®­ç»ƒéƒ¨åˆ†ï¼Œè¿›è¡Œå¢åŠ ä¸€äº›å‚æ•°

4. è®­ç»ƒç»“æœé¢„æµ‹ 
   è®­ç»ƒç»“æœé¢„æµ‹éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯yolo.pyå’Œpredict.pyã€‚  
   å®Œæˆä¿®æ”¹åå°±å¯ä»¥è¿è¡Œpredict.pyè¿›è¡Œæ£€æµ‹äº†ã€‚è¿è¡Œåè¾“å…¥å›¾ç‰‡è·¯å¾„å³å¯æ£€æµ‹ã€‚  ï¼ˆå¯ä»¥è‡ªå·±è®¾ç½®æ¨¡å¼å¾—åˆ°ç»“æœï¼‰

### 7.3. ä½¿ç”¨Tensorboardå¯è§†åŒ–ç»“æœ

åœ¨æˆ‘ä»¬è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨TensorBoardå®æ—¶æŸ¥çœ‹è®­ç»ƒæƒ…å†µï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°è®­ç»ƒçš„ç½‘ç»œæ¨¡å‹ç»“æ„ï¼Œéå¸¸æ–¹ä¾¿

åªéœ€è¦åœ¨æˆ‘ä»¬çš„æ–‡ä»¶å¤¹çš„å‘½ä»¤è¡Œä¸‹ï¼Œè¿è¡Œ

```bash
tensorboard --logdir='logs/'
```

ä¹‹åå¤§æ¦‚æˆ‘ä»¬çš„6006ç«¯å£å°±å¯ä»¥å®æ—¶çœ‹åˆ°æˆ‘ä»¬çš„ç»“æœï¼Œå³æ˜¯https://localhost:6006

> å¦‚æœæ˜¯ä½¿ç”¨Ubuntuï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¸€äº›bugï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¸€äº›æ“ä½œï¼Œå› ä¸ºä¼šæ˜¾ç¤ºæ— æ³•æ‰¾åˆ°å‘½ä»¤
>
> è¿™æ—¶å€™é¦–å…ˆéœ€è¦æ‰¾åˆ°TensorBoardåœ¨åº“çš„å“ªé‡Œ
>
> ```bash
> pip show tensorboard
> ```
>
> è¿™æ ·å­å°±èƒ½çœ‹åˆ°è‡ªå·±tensorboardä¸‹è½½çš„è·¯å¾„
>
> ç„¶åæ‰¾åˆ°TensorBoardçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰¾åˆ°main.pyæ–‡ä»¶ï¼Œå°±å¯ä»¥è¿›è¡Œäº†ï¼Œåˆ©ç”¨ç»å¯¹è·¯å¾„å°±å¯ä»¥äº†
>
> ```
> python .../python3.8/site-packages/tensorboard/main.py --logdir='logs/' 
> ```



### 7.4. é¢„æµ‹æ­¥éª¤

1. ä¸‹è½½å®Œåº“åè§£å‹ï¼Œåœ¨ç™¾åº¦ç½‘ç›˜åè€…å…¶ä»–åœ°æ–¹ä¸‹è½½yolo_gesture_weights.pthï¼Œæ”¾å…¥model_dataï¼Œè¿è¡Œpredict.pyï¼Œè°ƒæ•´æƒé‡è·¯å¾„

   åœ¨predict.pyä¸­äº‹å…ˆè®¾ç½®äº†`dir_predict`è¡¨ç¤ºéå†æ–‡ä»¶å¤¹è¿›è¡Œæ£€æµ‹å¹¶ä¿å­˜ã€‚é»˜è®¤éå†imgæ–‡ä»¶å¤¹ï¼Œä¿å­˜img_outæ–‡ä»¶å¤¹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨img_outä¸­å¾—åˆ°æ–‡ä»¶

   æœ‰å¾ˆå¤šç§æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡modeæ¥è°ƒèŠ‚ï¼Œè¿™ä¸€éƒ¨åˆ†è¿˜å¯ä»¥è®¾ç½®å‚æ•°ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä»helpé‡Œçœ‹åˆ°

   ```bash
   predict.py -h
   usage: predict.py [-h] [--weights WEIGHTS] [--tiny] [--phi PHI]
                     [--mode {dir_predict,video,fps,predict,heatmap,export_onnx}]
                     [--cuda] [--shape SHAPE] [--video VIDEO]
                     [--save-video SAVE_VIDEO] [--confidence CONFIDENCE]
                     [--nms_iou NMS_IOU]
   
   optional arguments:
     -h, --help            show this help message and exit
     --weights WEIGHTS     initial weights path
     --tiny                ä½¿ç”¨yolotinyæ¨¡å‹
     --phi PHI             yolov4tinyæ³¨æ„åŠ›æœºåˆ¶ç±»å‹
     --mode {dir_predict,video,fps,predict,heatmap,export_onnx}
                           é¢„æµ‹çš„æ¨¡å¼
     --cuda                è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨GPU
     --shape SHAPE         è¾“å…¥å›¾åƒçš„shape
     --video VIDEO         éœ€è¦æ£€æµ‹çš„è§†é¢‘æ–‡ä»¶
     --save-video SAVE_VIDEO
                           ä¿å­˜è§†é¢‘çš„ä½ç½®
     --confidence CONFIDENCE
                           åªæœ‰å¾—åˆ†å¤§äºç½®ä¿¡åº¦çš„é¢„æµ‹æ¡†ä¼šè¢«ä¿ç•™ä¸‹æ¥
     --nms_iou NMS_IOU     éæå¤§æŠ‘åˆ¶æ‰€ç”¨åˆ°çš„nms_iouå¤§å°
   ```

   å¦‚æœä¸‹è½½äº†æƒé‡äºè·¯å¾„model_data/yolov4_tiny.pthï¼Œé»˜è®¤æ˜¯æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡æ¨¡å¼è¿è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿è¡Œå¾—åˆ°ç»“æœ

   ```python
   python predict.py --tiny --phi 0 --weights model_data/yolov4_tiny.pth
   ```

2. åœ¨predict.pyé‡Œé¢è¿›è¡Œè®¾ç½®å¯ä»¥è¿›è¡Œfpsæµ‹è¯•å’Œvideoè§†é¢‘æ£€æµ‹ã€‚ ï¼ˆè¿™ä¸€éƒ¨åˆ†å¯ä»¥è‡ªå·±å°è¯•ï¼‰

   è¿™ä¸€éƒ¨åˆ†åªè¦è®¾ç½®ä¸€ä¸‹è·¯å¾„å’Œè§†é¢‘å³å¯ï¼Œåˆ†åˆ«æœ‰å¤šç§æ¨¡å¼



### 7.5. è¯„ä¼°æ­¥éª¤

1. æœ¬æ–‡ä½¿ç”¨VOCæ ¼å¼è¿›è¡Œè¯„ä¼°ã€‚  

2. å¦‚æœåœ¨è®­ç»ƒå‰å·²ç»è¿è¡Œè¿‡voc_annotation.pyæ–‡ä»¶ï¼Œä»£ç ä¼šè‡ªåŠ¨å°†æ•°æ®é›†åˆ’åˆ†æˆè®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚å¦‚æœæƒ³è¦ä¿®æ”¹æµ‹è¯•é›†çš„æ¯”ä¾‹ï¼Œå¯ä»¥ä¿®æ”¹voc_annotation.pyæ–‡ä»¶ä¸‹çš„trainval_percentã€‚trainval_percentç”¨äºæŒ‡å®š(è®­ç»ƒé›†+éªŒè¯é›†)ä¸æµ‹è¯•é›†çš„æ¯”ä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ (è®­ç»ƒé›†+éªŒè¯é›†):æµ‹è¯•é›† = 9:1ã€‚train_percentç”¨äºæŒ‡å®š(è®­ç»ƒé›†+éªŒè¯é›†)ä¸­è®­ç»ƒé›†ä¸éªŒè¯é›†çš„æ¯”ä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ è®­ç»ƒé›†:éªŒè¯é›† = 9:1ã€‚

3. åˆ©ç”¨voc_annotation.pyåˆ’åˆ†æµ‹è¯•é›†

4. è¿è¡Œget_map.pyå³å¯è·å¾—è¯„ä¼°ç»“æœï¼Œè¯„ä¼°ç»“æœä¼šä¿å­˜åœ¨map_outæ–‡ä»¶å¤¹ä¸­ã€‚






## 8. Streamlit é¡¹ç›®éƒ¨ç½²

ç»è¿‡ä¸Šè¿°å­¦ä¹ è¿‡ç¨‹ï¼Œæœ€åæˆ‘åˆ©ç”¨streamlitè¿›è¡Œäº†é¡¹ç›®éƒ¨ç½²ï¼Œå¯ä»¥åœ¨æœ¬åœ°éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥åœ¨äº‘ç«¯éƒ¨ç½²ï¼Œä»£ç å·²ç»ä¸Šä¼ çš„äº†ï¼Œå¹¶ä¸”æˆ‘æœ€åéƒ¨ç½²åˆ°äº†streamlitçš„æœåŠ¡å™¨ä¸­ï¼Œå¤§å®¶éƒ½å¯ä»¥åœ¨çº¿ä½“éªŒ [https://kedreamix-yologesture.streamlit.app/](https://kedreamix-yologesture.streamlit.app/)ï¼Œç„¶åé€‰æ‹©â€œRun the appâ€å³å¯ï¼Œä¸éœ€è¦è¿‡å¤šçš„æ“ä½œï¼Œäº‘ç«¯æœåŠ¡å™¨ä¼šä¼šè‡ªåŠ¨ä»æˆ‘çš„releaseä¸­ä¸‹è½½æ¨¡å‹ï¼Œæ‰€ä»¥è¿™ä¸ªä¸ç”¨æ‹…å¿ƒã€‚

> å…³äºstreamlitçš„ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘å¦ä¸€ç¯‡åšå®¢ï¼Œä¹Ÿæœ‰å¯¹åº”çš„githubé“¾æ¥ï¼Œé‚£ä¸ªç®€å•ä¸€ç‚¹[https://redamancy.blog.csdn.net/article/details/121788919](https://redamancy.blog.csdn.net/article/details/121788919)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/c62927213dc04faf855ed667d65602bd.png)



### 8.1. æœ¬åœ°è¿è¡Œ

æ‰“å¼€å‘½ä»¤è¡Œè¿è¡Œä»¥ä¸‹ä»£ç ï¼Œè®°ä½ï¼Œé¦–å…ˆè¿›è¡Œpip install streamlit

```python
streamlit run gesture.streamlit.py
```

è¿è¡Œä¹‹åï¼Œæ‰“å¼€çš„ https://localhost:8501 å°±å¯ä»¥çœ‹åˆ°è‡ªå·±çš„streamlitçš„ç•Œé¢äº†

![](https://img-blog.csdnimg.cn/45d6624063f649ec8083e75e94afaf28.png)

### 8.2. æ£€æµ‹æ–¹æ³•

åœ¨è¿™ä¸ªéƒ¨ç½²ç•Œé¢ä¸­ï¼Œæˆ‘ä¸€å…±è®¾äº†å‡ ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯

| æµ‹è¯•æ¨¡å‹æ–¹å¼ | æµ‹è¯•æ–¹å¼æè¿°                                                 |
| ------------ | ------------------------------------------------------------ |
| Example      | å·²æœ‰ä¸€éƒ¨åˆ†æ•°æ®åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶å¤¹é‡Œï¼Œå¯ä»¥è¯»å–è¿›è¡Œæ£€æµ‹           |
| Image        | å¯ä»¥è‡ªä¸»ä¸Šä¼ å¯¹åº”çš„å›¾ç‰‡è¿›è¡Œæ£€æµ‹![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/7db5de05f119415cae6a9cb0ef39d092.png) |
| Camera       | åˆ©ç”¨ç”µè„‘æ‘„åƒå¤´è¿›è¡Œæ£€æµ‹ï¼Œå¯¹æ‘„åƒå¤´è¿›è¡Œæ‹ç…§ï¼Œç„¶åå¯ä»¥æ£€æµ‹fpsï¼Œheatmap![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6c1b8f721ebe4e0f86d68bf321e210b2.png) |
| FPS          | ä¸Šä¼ ä¸€å¼ å›¾ç‰‡è¿›è¡ŒFPS                                          |
| Heatmap      | è¿›è¡Œä¸€ä¸ªçƒ­åŠ›å›¾çš„æ£€æµ‹ï¼Œå¯ä»¥çœ‹åˆ°æ¨¡å‹å…³æ³¨å“ªä¸€éƒ¨åˆ†![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/e2c53a474f764a0f99adb05b39c3bee9.png) |
| Real Time    | å®æ—¶æ£€æµ‹ï¼Œå¯èƒ½è¿™ä¸€éƒ¨åˆ†åœ¨äº‘æœåŠ¡å™¨æœ‰ç‚¹bugï¼Œå¯èƒ½è¦åœ¨è‡ªå·±ç”µè„‘ä¸‹æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œäº‘ç«¯ä¸å¯ç”¨ |
| Video        | ä¼ å…¥è§†é¢‘è¿›è¡Œæ£€æµ‹![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/ccde1a9f657d4e7587012bf753f36095.png) |

### 8.3. é€‰æ‹©æ¨¡å‹ä»¥åŠå‚æ•°

å¹¶ä¸”åœ¨ä¸‹é¢çš„éƒ¨åˆ†ï¼Œä¹Ÿè®¾ç½®äº†å‡ ä¸ªå‚æ•°ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨çš„æ¨¡å‹ï¼Œæ ¹æ®å‰é¢æ‰€è¯´çš„ï¼Œä¸€å…±æœ‰äº”ç§æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥è°ƒèŠ‚ä¼ å…¥çš„shapeï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœé€‰æ‹©tinyæ¨¡å‹ï¼Œè¦å‹¾é€‰â˜‘ï¸ä½¿ç”¨tinyæ¨¡å‹ï¼Œè¦ä¸é»˜è®¤å…¨æ˜¯yolov4æ¨¡å‹ï¼Œç„¶åtinyæ¨¡å‹çš„shapeç»Ÿä¸€åªæœ‰416ï¼Œåªæœ‰yolov4æ¨¡å‹æœ‰ä¸€ä¸ª608å’Œ416ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µé€‰æ‹©ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è°ƒèŠ‚ä¸€ä¸‹confidenceå’Œnmsçš„å‚æ•°ï¼Œé»˜è®¤åˆ†åˆ«æ˜¯0.5å’Œ0.3ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥é€šè¿‡æ»‘åŠ¨æ†æ¥ä¿®æ”¹çš„

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/88e387f27b3747c58a6c910281837c03.png)







## 9. å‚è€ƒReference

- [https://github.com/bubbliiiing/yolov4-pytorch](https://github.com/bubbliiiing/yolov4-pytorch)
- [https://github.com/qqwweee/keras-yolo3/](https://github.com/qqwweee/keras-yolo3/)  
- [https://github.com/Ma-Dan/keras-yolo4](https://github.com/Ma-Dan/keras-yolo4)  





## 10. ä»£ç æƒé‡å¯å¤ç°ï¼Œå·²å¼€æºï¼ˆæ±‚ğŸŒŸğŸŒŸğŸŒŸï¼‰

æ‰€æœ‰çš„ä¸Šè¿°ä»£ç æƒé‡å…¨éƒ¨å¯å¤ç°ï¼Œå·²ç»å…¨éƒ¨å¼€æºï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå–https://github.com/Kedreamix/YoloGesture

æœ‰é—®é¢˜æ¬¢è¿åœ¨issueä¸­è®¨è®ºï¼Œæœ€ååˆ›ä½œä¸æ˜“ï¼Œç»™æˆ‘ä¸ªæ˜Ÿæ˜Ÿå§å“ˆå“ˆå“ˆstarä¸€ä¸‹ï¼ŒğŸŒŸğŸŒŸğŸŒŸ